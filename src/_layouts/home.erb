<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <%= render "head", metadata: site.metadata, title: data.title %>
  <style>
    /* Âü∫Á§é‰ΩàÂ±Ä */
    body { line-height: 1.9; color: #333; font-family: sans-serif; }
    .docs-container { display: flex; max-width: 1200px; margin: 0 auto; padding: 20px; }
    .sidebar { width: 250px; position: sticky; top: 20px; height: calc(100vh - 40px); overflow-y: auto; padding-right: 20px; border-right: 1px solid #eee; font-size: 0.9rem; }
    .main-content { flex: 1; padding-left: 40px; max-width: 800px; }
    
    /* ÂÖßÂÆπÊ®£Âºè */
    p { margin-bottom: 1.8rem; }
    h2 { border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-top: 50px; color: #0056b3; }
    h3 { border-left: 5px solid #6c757d; padding-left: 10px; margin-top: 40px; }
    .callout { padding: 1rem; margin: 1.5rem 0; border-left: 0.3rem solid; border-radius: 0.2rem; background-color: #f8f9fa; }
    .callout-info { border-left-color: #2196f3; background-color: #e3f2fd; }
    .callout-warning { border-left-color: #ff9800; background-color: #fff3e0; }
    .callout-danger { border-left-color: #f44336; background-color: #ffebee; }
    img { max-width: 550px !important; height: auto; display: block; margin: 30px 0; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); cursor: zoom-in; }

    /* --- ÁáàÁÆ±ÊïàÊûú (Lightbox) CSS --- */
    #lightbox {
      display: none;
      position: fixed;
      z-index: 10000;
      top: 0; left: 0; width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.85);
      cursor: zoom-out;
      justify-content: center;
      align-items: center;
    }
    #lightbox img {
      max-width: 90%;
      max-height: 90%;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      cursor: default;
      transition: transform 0.3s ease;
    }
    #progress-bar { position: fixed; top: 0; left: 0; height: 4px; background: #007bff; width: 0; z-index: 9999; }
  </style>
</head>
<body>
  <div id="progress-bar"></div>
  
  <div id="lightbox" onclick="this.style.display='none'">
    <img id="lightbox-img" src="" alt="ÊîæÂ§ßÂúñ">
  </div>

  <div class="docs-container">
    <nav class="sidebar">
      <h3 style="border:none; padding:0;">üìú ÁõÆÈåÑ</h3>
      <div id="toc"></div>
    </nav>
    <main class="main-content">
      <%= yield %>
    </main>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // 1. Ëá™ÂãïÁîüÊàêÁõÆÈåÑ (TOC)
      const toc = document.getElementById("toc");
      const headings = document.querySelectorAll(".main-content h2, .main-content h3");
      const tocList = document.createElement("ul");
      tocList.style.paddingLeft = "10px";
      headings.forEach((heading, index) => {
        const id = "section-" + index;
        heading.setAttribute("id", id);
        const li = document.createElement("li");
        li.style.listStyle = "none";
        li.style.marginBottom = "8px";
        const a = document.createElement("a");
        a.href = "#" + id;
        a.textContent = heading.textContent;
        a.style.textDecoration = "none";
        a.style.color = heading.tagName === "H2" ? "#333" : "#666";
        if (heading.tagName === "H2") a.style.fontWeight = "bold";
        li.appendChild(a);
        tocList.appendChild(li);
      });
      toc.appendChild(tocList);

      // 2. ÁáàÁÆ±ÈªûÊìäÈÇèËºØ
      const lightbox = document.getElementById('lightbox');
      const lightboxImg = document.getElementById('lightbox-img');
      
      document.querySelectorAll('.main-content img').forEach(img => {
        img.onclick = function(e) {
          e.stopPropagation(); // Èò≤Ê≠¢Ëß∏ÁôºÂÖ∂‰ªñ‰∫ã‰ª∂
          lightbox.style.display = 'flex';
          lightboxImg.src = this.src;
        };
      });

      // 3. ÈÄ≤Â∫¶Ê¢ùÈÇèËºØ
      window.onscroll = function() {
        var winScroll = document.body.scrollTop || document.documentElement.scrollTop;
        var height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        document.getElementById("progress-bar").style.width = (winScroll / height) * 100 + "%";
      };
    });
  </script>
</body>
</html>
